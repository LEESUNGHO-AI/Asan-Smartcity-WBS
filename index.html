<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì‚° ìŠ¤ë§ˆíŠ¸ì‹œí‹° WBS í†µí•© ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1e3a5f;
            --secondary: #3d5a80;
            --accent: #ee6c4d;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--gray-100);
            min-height: 100vh;
            color: var(--gray-800);
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .header-info {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .badge {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .badge a { color: white; text-decoration: none; }
        
        .sync-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .kpi-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .kpi-card.primary { border-left-color: var(--primary); }
        .kpi-card.info { border-left-color: var(--info); }
        .kpi-card.success { border-left-color: var(--success); }
        .kpi-card.warning { border-left-color: var(--warning); }
        .kpi-card.danger { border-left-color: var(--danger); }
        
        .kpi-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .kpi-value { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .kpi-label { color: var(--gray-600); font-size: 0.875rem; margin-top: 0.25rem; }
        
        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .chart-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chart-container { height: 280px; position: relative; }
        
        /* Section */
        .section {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Filters */
        .filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-200);
            background: white;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .filter-btn:hover { border-color: var(--primary); color: var(--primary); }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .search-input {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            width: 250px;
            font-size: 0.875rem;
        }
        
        .search-input:focus { outline: none; border-color: var(--primary); }
        
        /* Business Area Cards */
        .area-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1rem;
        }
        
        .area-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 0.75rem;
            padding: 1.25rem;
            transition: all 0.2s;
        }
        
        .area-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(30,58,95,0.1);
        }
        
        .area-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .area-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary);
            line-height: 1.3;
        }
        
        .area-count {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .progress-bar-bg {
            background: var(--gray-200);
            border-radius: 0.5rem;
            height: 8px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }
        
        .progress-bar-fill {
            height: 100%;
            border-radius: 0.5rem;
            transition: width 0.5s ease;
        }
        
        .progress-low { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .progress-mid { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .progress-high { background: linear-gradient(90deg, #10b981, #059669); }
        
        .area-stats {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .stat-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .stat-todo { background: #fef3c7; color: #92400e; }
        .stat-progress { background: #dbeafe; color: #1e40af; }
        .stat-complete { background: #d1fae5; color: #065f46; }
        
        /* Table */
        .table-wrapper { overflow-x: auto; }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .data-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            white-space: nowrap;
            position: sticky;
            top: 0;
        }
        
        .data-table tbody tr:hover { background: var(--gray-50); }
        
        .task-title {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .status-ëŒ€ê¸°, .status-ì§„í–‰\ ì „ { background: #fef3c7; color: #92400e; }
        .status-ì§„í–‰\ ì¤‘, .status-ì—…ë¬´í˜‘ì˜, .status-ê³„ì•½ì§„í–‰ì¤‘, .status-ìë£Œ\ ì‘ì„±, 
        .status-ìë£Œ\ ëŒ€ì‘, .status-ìš©ì—­ë°œì£¼, .status-ê³„ì•½, .status-êµ¬ì¶•, 
        .status-ëŒ€ê¸ˆ\ ì§‘í–‰, .status-í…ŒìŠ¤íŠ¸ì¤‘ { background: #dbeafe; color: #1e40af; }
        .status-ì™„ë£Œ, .status-ê³„ì•½ì™„ë£Œ, .status-ì‘ì„±ì™„ë£Œ, .status-í’ˆì˜ì™„ë£Œ, 
        .status-ì‘ì—…ì™„ë£Œ, .status-ì¢…ë£Œ { background: #d1fae5; color: #065f46; }
        .status-ì¤‘ë‹¨ { background: #fee2e2; color: #991b1b; }
        
        .priority-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .priority-P0 { background: #fee2e2; color: #991b1b; }
        .priority-P1 { background: #fef3c7; color: #92400e; }
        .priority-P2 { background: #d1fae5; color: #065f46; }
        .priority-P3 { background: #e5e7eb; color: #374151; }
        
        .notion-link {
            color: var(--info);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .notion-link:hover { text-decoration: underline; }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--gray-600);
            font-size: 0.875rem;
        }
        
        .footer a { color: var(--primary); text-decoration: none; }
        
        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--gray-600);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 1.25rem; }
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .charts-grid { grid-template-columns: 1fr; }
            .area-grid { grid-template-columns: 1fr; }
            .search-input { width: 100%; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>ğŸ™ï¸ ì•„ì‚° ìŠ¤ë§ˆíŠ¸ì‹œí‹° WBS í†µí•© ëŒ€ì‹œë³´ë“œ</h1>
            <div class="header-info">
                <div class="badge">
                    <div class="sync-dot"></div>
                    <span>ì‹¤ì‹œê°„ ë™ê¸°í™”</span>
                </div>
                <div class="badge">ğŸ“… <span id="syncTime">-</span></div>
                <div class="badge">
                    <a href="https://www.notion.so/2a250aa9577d80ca8bf2f2abfce71a59" target="_blank">ğŸ“ Notion ì›ë³¸</a>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="loadingState" class="loading">
            <div class="spinner"></div>
            <p style="margin-top: 1rem;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        
        <div id="dashboard" style="display: none;">
            <!-- KPI Cards -->
            <section class="kpi-grid" id="kpiSection"></section>

            <!-- Charts -->
            <section class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">ğŸ“Š ì§„í–‰í˜„í™© ë¶„í¬</div>
                    <div class="chart-container"><canvas id="statusChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">ğŸ¯ ìš°ì„ ìˆœìœ„ë³„ í˜„í™©</div>
                    <div class="chart-container"><canvas id="priorityChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">ğŸ‘¤ ë‹´ë‹¹ìë³„ ì—…ë¬´</div>
                    <div class="chart-container"><canvas id="assigneeChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">ğŸ“ˆ ì—…ë¬´ì˜ì—­ë³„ ì§„ì²™ë¥ </div>
                    <div class="chart-container"><canvas id="progressChart"></canvas></div>
                </div>
            </section>

            <!-- Business Areas -->
            <section class="section">
                <div class="section-header">
                    <div class="section-title">ğŸ¯ ë‹¨ìœ„ì‚¬ì—…ë³„ WBS í˜„í™©</div>
                    <div class="filters">
                        <input type="text" class="search-input" id="areaSearch" placeholder="ğŸ” ë‹¨ìœ„ì‚¬ì—… ê²€ìƒ‰...">
                    </div>
                </div>
                <div class="area-grid" id="areaGrid"></div>
            </section>

            <!-- Tasks Table -->
            <section class="section">
                <div class="section-header">
                    <div class="section-title">ğŸ“‹ WBS ìƒì„¸ ëª©ë¡</div>
                    <div class="filters">
                        <input type="text" class="search-input" id="taskSearch" placeholder="ğŸ” ì‘ì—… ê²€ìƒ‰...">
                        <button class="filter-btn active" data-filter="all">ì „ì²´</button>
                        <button class="filter-btn" data-filter="in_progress">ì§„í–‰ì¤‘</button>
                        <button class="filter-btn" data-filter="to_do">ëŒ€ê¸°</button>
                        <button class="filter-btn" data-filter="complete">ì™„ë£Œ</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ì—…ë¬´ í•­ëª©</th>
                                <th>ì—…ë¬´ ì˜ì—­</th>
                                <th>ë‹´ë‹¹ì</th>
                                <th>ìš°ì„ ìˆœìœ„</th>
                                <th>ì§„í–‰í˜„í™©</th>
                                <th>ì§„ì²™ë¥ </th>
                                <th>Notion</th>
                            </tr>
                        </thead>
                        <tbody id="taskTableBody"></tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <footer class="footer">
        <p>ğŸ›ï¸ ì•„ì‚° ì»´íŒ©íŠ¸ ìŠ¤ë§ˆíŠ¸ì‹œí‹° ì¡°ì„±ì‚¬ì—… | ì œì¼ì—”ì§€ë‹ˆì–´ë§ PMO</p>
        <p>GitHub Pages ìë™ ë°°í¬ | ë°ì´í„° ì¶œì²˜: <a href="https://www.notion.so/2a250aa9577d80ca8bf2f2abfce71a59" target="_blank">Notion WBS Database</a></p>
    </footer>

    <script>
        let wbsData = null;
        let charts = {};

        const STATUS_GROUPS = {
            to_do: ['ì§„í–‰ ì „', 'ëŒ€ê¸°'],
            in_progress: ['ì§„í–‰ ì¤‘', 'ì—…ë¬´í˜‘ì˜', 'ê³„ì•½ì§„í–‰ì¤‘', 'ìë£Œ ì‘ì„±', 'ìë£Œ ëŒ€ì‘', 'ìš©ì—­ë°œì£¼', 'ê³„ì•½', 'êµ¬ì¶•', 'ëŒ€ê¸ˆ ì§‘í–‰', 'í…ŒìŠ¤íŠ¸ì¤‘'],
            complete: ['ì™„ë£Œ', 'ê³„ì•½ì™„ë£Œ', 'ì‘ì„±ì™„ë£Œ', 'í’ˆì˜ì™„ë£Œ', 'ì‘ì—…ì™„ë£Œ', 'ì¢…ë£Œ', 'ì¤‘ë‹¨']
        };

        function classifyStatus(status) {
            for (const [group, statuses] of Object.entries(STATUS_GROUPS)) {
                if (statuses.includes(status)) return group;
            }
            return 'to_do';
        }

        async function loadData() {
            try {
                const response = await fetch('data/wbs-data.json');
                if (!response.ok) throw new Error('ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                wbsData = await response.json();
                renderDashboard();
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('loadingState').innerHTML = `
                    <div style="text-align: center; color: #ef4444;">
                        <p style="font-size: 1.5rem; margin-bottom: 1rem;">âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</p>
                        <p>GitHub Actionsë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•´ì£¼ì„¸ìš”.</p>
                        <p style="margin-top: 1rem; color: #6b7280;">ì˜¤ë¥˜: ${error.message}</p>
                    </div>
                `;
            }
        }

        function renderDashboard() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';

            const { statistics, metadata } = wbsData;
            
            // Sync time
            const syncDate = new Date(metadata.synced_at);
            document.getElementById('syncTime').textContent = `ë™ê¸°í™”: ${syncDate.toLocaleString('ko-KR')}`;

            // KPI Cards
            renderKPIs(statistics);
            
            // Charts
            renderCharts(statistics);
            
            // Area Cards
            renderAreaCards();
            
            // Task Table
            renderTaskTable();
            
            // Event Listeners
            setupEventListeners();
        }

        function renderKPIs(stats) {
            const kpis = [
                { icon: 'ğŸ“‹', value: stats.total_items, label: 'ì´ ì‘ì—… í•­ëª©', type: 'primary' },
                { icon: 'âš¡', value: stats.status_groups.in_progress, label: 'ì§„í–‰ì¤‘', type: 'info' },
                { icon: 'âœ…', value: stats.status_groups.complete, label: 'ì™„ë£Œ', type: 'success' },
                { icon: 'â³', value: stats.status_groups.to_do, label: 'ëŒ€ê¸°', type: 'warning' },
                { icon: 'ğŸ“Š', value: `${stats.overall_progress}%`, label: 'í‰ê·  ì§„ì²™ë¥ ', type: 'primary' },
                { icon: 'ğŸ¯', value: Object.keys(stats.by_business_area).length, label: 'ë‹¨ìœ„ì‚¬ì—…', type: 'info' }
            ];

            document.getElementById('kpiSection').innerHTML = kpis.map(kpi => `
                <div class="kpi-card ${kpi.type}">
                    <div class="kpi-icon">${kpi.icon}</div>
                    <div class="kpi-value">${kpi.value}</div>
                    <div class="kpi-label">${kpi.label}</div>
                </div>
            `).join('');
        }

        function renderCharts(stats) {
            // Status Chart (Doughnut)
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            charts.status = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ëŒ€ê¸°', 'ì§„í–‰ì¤‘', 'ì™„ë£Œ'],
                    datasets: [{
                        data: [stats.status_groups.to_do, stats.status_groups.in_progress, stats.status_groups.complete],
                        backgroundColor: ['#f59e0b', '#3b82f6', '#10b981'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            // Priority Chart
            const priorityData = stats.by_priority;
            const priorityCtx = document.getElementById('priorityChart').getContext('2d');
            charts.priority = new Chart(priorityCtx, {
                type: 'bar',
                data: {
                    labels: ['P0 (í•„ìˆ˜)', 'P1 (ì¤‘ìš”)', 'P2 (ì„ íƒ)', 'P3 (ë‚®ìŒ)'],
                    datasets: [{
                        label: 'ì‘ì—… ìˆ˜',
                        data: [priorityData['P0'] || 0, priorityData['P1'] || 0, priorityData['P2'] || 0, priorityData['P3'] || 0],
                        backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#6b7280'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // Assignee Chart
            const assigneeData = Object.entries(stats.by_assignee || {})
                .filter(([k]) => k !== 'ë¯¸ë°°ì •')
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);
            const assigneeCtx = document.getElementById('assigneeChart').getContext('2d');
            charts.assignee = new Chart(assigneeCtx, {
                type: 'bar',
                data: {
                    labels: assigneeData.map(([k]) => k),
                    datasets: [{
                        label: 'ë‹´ë‹¹ ì—…ë¬´ ìˆ˜',
                        data: assigneeData.map(([, v]) => v),
                        backgroundColor: '#3d5a80',
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });

            // Progress Chart
            const areaProgress = Object.entries(stats.by_business_area || {})
                .map(([k, v]) => ({ name: k, progress: v.avg_progress || 0 }))
                .sort((a, b) => b.progress - a.progress)
                .slice(0, 8);
            const progressCtx = document.getElementById('progressChart').getContext('2d');
            charts.progress = new Chart(progressCtx, {
                type: 'bar',
                data: {
                    labels: areaProgress.map(a => a.name.length > 15 ? a.name.slice(0, 15) + '...' : a.name),
                    datasets: [{
                        label: 'í‰ê·  ì§„ì²™ë¥  (%)',
                        data: areaProgress.map(a => a.progress),
                        backgroundColor: areaProgress.map(a => 
                            a.progress >= 70 ? '#10b981' : a.progress >= 30 ? '#f59e0b' : '#ef4444'
                        ),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });
        }

        function renderAreaCards(filter = '') {
            const grouped = wbsData.grouped_by_business_area;
            const stats = wbsData.statistics.by_business_area;
            
            const areas = Object.entries(grouped)
                .filter(([name]) => name.toLowerCase().includes(filter.toLowerCase()))
                .sort((a, b) => b[1].length - a[1].length);

            document.getElementById('areaGrid').innerHTML = areas.map(([name, items]) => {
                const areaStats = stats[name] || { count: items.length, avg_progress: 0, to_do: 0, in_progress: 0, complete: 0 };
                const progress = areaStats.avg_progress || 0;
                const progressClass = progress >= 70 ? 'progress-high' : progress >= 30 ? 'progress-mid' : 'progress-low';
                
                return `
                    <div class="area-card" data-area="${name}">
                        <div class="area-header">
                            <div class="area-name">${name}</div>
                            <div class="area-count">${items.length}ê°œ</div>
                        </div>
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill ${progressClass}" style="width: ${progress}%"></div>
                        </div>
                        <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">
                            í‰ê·  ì§„ì²™ë¥ : <strong>${progress}%</strong>
                        </div>
                        <div class="area-stats">
                            ${areaStats.to_do ? `<span class="stat-badge stat-todo">ëŒ€ê¸° ${areaStats.to_do}</span>` : ''}
                            ${areaStats.in_progress ? `<span class="stat-badge stat-progress">ì§„í–‰ ${areaStats.in_progress}</span>` : ''}
                            ${areaStats.complete ? `<span class="stat-badge stat-complete">ì™„ë£Œ ${areaStats.complete}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderTaskTable(statusFilter = 'all', searchFilter = '') {
            let items = wbsData.items;
            
            if (statusFilter !== 'all') {
                items = items.filter(item => classifyStatus(item.progress_status) === statusFilter);
            }
            
            if (searchFilter) {
                const term = searchFilter.toLowerCase();
                items = items.filter(item => 
                    (item.title || '').toLowerCase().includes(term) ||
                    (item.business_area || '').toLowerCase().includes(term) ||
                    (item.assignees || []).join(' ').toLowerCase().includes(term)
                );
            }

            document.getElementById('taskTableBody').innerHTML = items.slice(0, 100).map(item => {
                const statusClass = `status-${(item.progress_status || '').replace(/ /g, '\\ ')}`;
                const priorityClass = `priority-${item.priority || ''}`;
                const progress = item.progress || 0;
                const progressClass = progress >= 70 ? 'progress-high' : progress >= 30 ? 'progress-mid' : 'progress-low';

                return `
                    <tr>
                        <td class="task-title" title="${item.title}">${item.title}</td>
                        <td>${item.business_area || '-'}</td>
                        <td>${(item.assignees || []).join(', ') || '-'}</td>
                        <td><span class="priority-badge ${priorityClass}">${item.priority || '-'}</span></td>
                        <td><span class="status-badge ${statusClass}">${item.progress_status || '-'}</span></td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="progress-bar-bg" style="width: 60px; height: 6px;">
                                    <div class="progress-bar-fill ${progressClass}" style="width: ${progress}%"></div>
                                </div>
                                <span style="font-size: 0.75rem;">${progress}%</span>
                            </div>
                        </td>
                        <td>
                            ${item.url ? `<a href="${item.url}" target="_blank" class="notion-link">ğŸ“ ì—´ê¸°</a>` : '-'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function setupEventListeners() {
            // Area Search
            document.getElementById('areaSearch').addEventListener('input', (e) => {
                renderAreaCards(e.target.value);
            });

            // Task Search
            document.getElementById('taskSearch').addEventListener('input', (e) => {
                const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
                renderTaskTable(activeFilter, e.target.value);
            });

            // Filter Buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const searchTerm = document.getElementById('taskSearch').value;
                    renderTaskTable(btn.dataset.filter, searchTerm);
                });
            });
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
